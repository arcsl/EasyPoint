<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Generar RTF con tabla</title>
</head>
<body>
  <button onclick="descargarRTF()">Descargar documento RTF</button>

  <script>
    function descargarRTF() {
      const rtfHeader = `{\\rtf1\\ansi
{\\colortbl ;\\red100\\green149\\blue237;}
{\\fonttbl\\f0\\fswiss Helvetica;}
\\f0\\fs24
`;
      const rtfFooter = `}
      `;

      function seccion(numero, titulo) {
        return `\\fs36\\b\\cf1 ${numero}. ${titulo} \\b0\\cf0\\line\\line`;
      }

      function subseccion(numero, titulo) {
        return `\\fs24\\b\\cf1 ${numero} ${titulo} \\b0\\cf0\\line`;
      }

      function parrafo(texto) {
        return `${texto}\\line\\line`;
      }

      // Tabla: columnas con posiciones absolutas (medidas en twips: 1cm ≈ 567 twips)
      function tablaPLC() {
        const rows = [
          ["Descripción", "EA", "ED", "SA", "SD"],
          ["Entrada digital general", 4, 0, 0, 0],
          ["Entrada analógica temperatura", 0, 2, 0, 0],
          ["Salida digital actuadores", 0, 0, 6, 0],
          ["Salida analógica válvulas", 0, 0, 0, 2],
        ];

        const colStops = [5000, 6000, 7000, 8000, 9000]; // twips

        const tabla = rows.map(row => {
          let line = "\\trowd\\trgaph108"; // nueva fila
          for (let i = 0; i < colStops.length; i++) {
            line += `\\cellx${colStops[i]}`;
          }
          // Añadir celdas
          line += row.map(cell => `\\intbl ${cell} \\cell`).join("");
          line += "\\row\n";
          return line;
        });

        return tabla.join("\n") + "\n\\line\\line";
      }

      const contenido = [
        seccion(3, "Estudio de puntos del PLC"),
        parrafo("La siguiente tabla muestra el recuento de entradas y salidas del sistema."),
        tablaPLC()
      ].join("\n");

      const rtfCompleto = rtfHeader + contenido + rtfFooter;
      const blob = new Blob([rtfCompleto], { type: "application/rtf" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = "documento_plc.rtf";
      link.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
