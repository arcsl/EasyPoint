<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8" />
	<title>Generador DXF</title>
	<script src="basicosDXF.js"></script>
	<script src="bloquesDXF.js"></script>
	<script src="simbolos.js"></script>
</head>

<body>
	<h2>Generador DXF</h2>
	<script>

		descargarDXF();

		function descargarDXF() {

			const entities = [];

			// 4 cajetines
			const test = {
				Refe: 'Refe 1',
				Hoja: '-',
				Loca: 'Loca 1',
				Clie: 'Clie 1',
				Fech: 'Fech 1',
				Dibu: 'Dibu 1',
				Esqu: 'Esqu 1',
				Inst: 'Inst 1',
			}

			test.Hoja = "1 - 4";
			entities.push(...cajetin(0, 300, test));
			test.Hoja = "2 - 4";
			entities.push(...cajetin(420, 300, test));
			test.Hoja = "3 - 4";
			entities.push(...cajetin(0, 0, test));
			test.Hoja = "4 - 4";
			entities.push(...cajetin(420, 0, test));

			// datos "controlador"
			largo = 360;
			inicial = (400 - largo) / 2;

			// todos los simbolos en el cajetin 3
			entities.push(...hash52    (100, 100));
			entities.push(...hash25    (110, 100));
			entities.push(...hashUD    (120, 100));
			entities.push(...hashD     (130, 100));
			entities.push(...hashU     (140, 100));
			entities.push(...hashPalo  (150, 100));
			entities.push(...hashGuion (160, 100));
			entities.push(...hashSep   (170, 100));
			entities.push(...hashmD    (180, 100));
			entities.push(...hashLan   (190, 100));
			entities.push(...hashEnv   (inicial, 236, largo));

			// Finalizar el archivo
			let dxfContent = wrapDXF(entities);

			// Quitar Caracteres No ASCII
			dxfContent = quitarCaracteresNoASCII(dxfContent);

			// Descargar archivo
			const blob = new Blob([dxfContent], { type: 'application/dxf' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = 'generado.dxf';
			a.click();
			URL.revokeObjectURL(url);

		}

		function quitarCaracteresNoASCII(texto) {
			return texto
				// Quita tildes y signos raros (ñ → n, á → a, etc.)
				.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
				// Reemplaza cualquier carácter no ASCII (códigos > 127) por espacio
				.replace(/[^\x00-\x7F]/g, '');
		}

	</script>
</body>

</html>